<!DOCTYPE html>
<html lang="ru" >
<head>
    <title>Page Title</title>
</head>
<body>
<h1 style="text-align:center"><strong>Kitsune scripts api</strong></h1>

<p style="text-align:center">API для скриптов (примеры скриптов смотрите в разделе редактирования):</p>

<p style="text-align:center">Весь проект вместе с примерами скриптов можно посмотреть на <a href="https://github.com/alex-bayir/Kitsune">github</a>.</p>

<p style="text-align:center">(Если возникнут трудности можете писать в группу в вк в беседу скриптов и API)</p>

<p style="text-align:center">(так же принимаются предложения о том что добавить или как улучшить приложение)</p>

<p>&nbsp;</p>

<p>Первым делом вам необходимо определить глобальные переменные:</p>

<p><strong>version</strong> &ndash; версия скрипта<br />
    <strong>domain</strong> &ndash; провайдер (например mangalib.me)<br />
    <strong>source</strong> &ndash; имя провайдера (например MangaLib)<br />
    <strong>Type</strong> &ndash; тип (например Manga или Ranobe)<br />
    <strong>description</strong> &ndash; описание ресурса<br />
    <strong>auth_tokens</strong> &ndash; токены для авторизации (например для мангалиба: auth_tokens={&quot;mangalib_session&quot;,&quot;XSRF-TOKEN&quot;})</p>

<p><strong>icon</strong> - ссылка на иконку источника (обычно удаётся её получить через статику гугла, но если не получается или вас не устраивает укажите ссылку)</p>

<p>&nbsp;</p>

<p>Дальше необходимо реализовать функцию <strong>query_url</strong>, чтобы осуществлять поиск манги по уже готовой ссылке и получать по ним основные сведения такие как <strong>ссылка на основную страницу данной книги</strong> (манги, ранобе и других типов) (для функции <strong>update</strong>), название, рейтинг, описание и т.д. Все эти данные запихиваете в ассоциативный массив и возвращаете список таких массивов (для Lua ассоциативный массив это таблица).</p>

<p><code>List&lt;Map&lt;String,Object&gt;&gt; query_url(String url, int page)</code></p>

<p>&nbsp;</p>

<p>Дальше необходимо реализовать функцию <strong>query</strong>, чтобы осуществлять поиск манги и получать по ним основные сведения такие как ссылка на основную страницу данной манги(для функции update), название, рейтинг, описание и т.д. Все эти данные запихиваете в ассоциативный массив и возвращаете список таких ассоциативных массивов. По возможности здесь должна формироваться полная ссылка, что бы потом вы могли передать её в query_url и от туда получить результат.</p>

<p><code>List&lt;Map&lt;String,Object&gt;&gt; query(String name, int page, Options[] params)<br />
    - params нужен для расширенного поиска</code></p>

<p>&nbsp;</p>

<p>Дальше необходимо реализовать функцию <strong>update</strong>, чтобы обновлять данные по манге (точно так же как и в функции query так же получаете и запихиваете данные в ассоциативный массив, только теперь ещё и основные данные по главам но вернуть уже нужно только один такой ассоциативный массив), а также получать данные о похожей манге (если есть возможность, не загружая другую страницу, а для таких случаев можно реализовать другую функцию которая указана ниже).</p>

<p><code>Map&lt;String,Object&gt; update(String url)</code></p>

<p>&nbsp;</p>

<p>Дальше необходимо реализовать функцию <strong>getPages</strong>, чтобы получать ссылки на страницы (изображения) (однако вместо ссылок можно передавать текст если в главе содержатся не только картинки) главы, вернуть нужно массив объектов Page.</p>

<p><code>List&lt;Page&gt; getPages(String url,Chapter chapter)</code></p>

<p>&nbsp;</p>

<p>Дальше необходимо реализовать функцию <strong>load</strong>, чтобы скачивать страницы по полученным ссылкам (в этом методе можно).</p>

<p><code>Throwable load(File file,String data,boolean url,Boolean cancel_flag, Callback&lt;Long,Long&gt; progress)</code></p>

<p><code>- data - это ссылка или текст</code></p>

<p><code>- url - true если data это ссылка и false если нет</code></p>

<p><code>- cancel_flag и progress внутренние переменные приложения которые необходимо передать без изменений</code></p>

<p>&nbsp;</p>

<p>Для расширенного поиска нужно реализовать функцию <strong>createAdvancedSearchOptions</strong>, которая будет возвращать список объектов Options.</p>

<p><code>List&lt;Options&gt; createAdvancedSearchOptions()</code></p>

<p>&nbsp;</p>

<p>Для загрузки данных похожей манги можете реализовать функцию <strong>loadSimilar</strong>, которая будет возвращать List&lt;Map&lt;String,Object&gt;&gt; (если в функции update не возможно получить эти данные не загружая другую страницу).</p>

<p><code>List&lt;Map&lt;String,Object&gt;&gt; loadSimilar(Map&lt;String,Object&gt; book)</code></p>

<p>&nbsp;</p>

<h3>Статические методы и конструкторы которые вы можете использовать в <strong>Lua</strong>:</h3>

<p><em>курсивом обозначены необязательные параметры</em></p>

<p><strong><code>network (для создания запросов)</code></strong></p>

<p><code>network:load(client,url,domain,file,cancel_flag,listener) - Throwable</code></p>

<p><code>network:load(client,url,headers,file,cancel_flag,listener)&nbsp;- Throwable</code></p>

<p><code>network:load(client,url,domain,headers,file,cancel_flag,listener)&nbsp;- Throwable</code></p>

<p><code>network:getClient() - OkHtttpClient</code></p>

<p><code>network:getClient(descramble)&nbsp;- OkHtttpClient # boolean descrabmle (watch source MangaTeaderTo)</code></p>

<p><code>network:getCookie(key) - String</code></p>

<p><code>network:getCookie(cookies,key) - String&nbsp;# List&lt;Cookie&gt; cookies</code></p>

<p><code>network:decode(encoded) - String # decode url special chars</code></p>

<p><code>network:encode(decoded) - String # encode url special chars</code></p>

<p><code>network:load(url,headers) - String</code></p>

<p><code>network:load_as_String(url,headers,body,type) - String</code></p>

<p><code>network:load_as_Document(url,headers,body) - org.jsoup.nodes.Document</code></p>

<p><code>network:url_builder(host) - org.alex.kitsune.commons.URLBuilder</code></p>

<p><code>network:parse(html) -&nbsp;org.jsoup.nodes.Document</code></p>

<p><strong><code>utils</code></strong></p>

<p><code>utils:write(file,text,append) - Throwable # java.io.File file; String text; boolean append</code></p>

<p><code>utils:unescape_unicodes(escaped) - String</code></p>

<p><code>utils:to_map(table) - Map&lt;?,?&gt; # для преобразования в java объект (нужно не везде)</code></p>

<p><code>utils:to_list(table) - List&lt;?,?&gt; # для преобразования в java объект (нужно не везде)</code></p>

<p><code>utils:parseDate(date,format) - long # date to timestamp</code></p>

<p><code>utils:attr(element,attr,def) - String # исключение nullpointerexception</code></p>

<p><code>utils:text(element,def) - String # исключение nullpointerexception</code></p>

<p><code>utils:attr(elements,attr,def,delimeter) - String&nbsp;# исключение nullpointerexception</code></p>

<p><code>utils:text(elements,def,delimeter) - String&nbsp;# исключение nullpointerexception</code></p>

<p><code>utils:uniqueChapters(chapters,translator_with_max_chapters,translator) - List&lt;Chapter&gt; #&nbsp;List&lt;Chapter&gt; chapters; boolean&nbsp;translator_with_max_chapters; String translator</code></p>

<p><strong><code>JSONObject (обычный json объект только унаследованный от TreeMap)</code></strong></p>

<p><strong><code>JSONArray&nbsp;(обычный json массив только унаследованный от LinkedList)</code></strong></p>

<p><strong><code>Chapter</code></strong></p>

<p><code>Chapter.new(vol,num,name,date,additional,pages) - Chapter # int vol; float num; String name; long date; Map&lt;String,Object&gt; additional</code></p>

<p><code>Chapter.new(vol,num,name,date,additional,pages) - Chapter # int vol; String num; String name; long date; Map&lt;String,Object&gt; additional</code></p>

<p><code>Chapter.new(vol,num,name,date,additional,pages) - Chapter # String vol; String num; String name; long date; Map&lt;String,Object&gt; additional</code></p>

<p><strong><code>Page</code></strong></p>

<p><code>Page.new(num,data) - Page # float num; String data (url or text)</code></p>

<p><strong><code>Options</code></strong></p>

<p><code>Options.new(key,mode) - Options # String key, int mode (4 - range; another - input)</code></p>

<p><code>Options.new(title,values,mode) - Options # String title; Map&lt;String,String&gt; values; int mode (1,2,3)</code></p>

<p><code>Options.new(title,descending, ascending, values, mode) - Options #&nbsp;String title; String descending; String ascending; Map&lt;String,String&gt; values; int mode (1,2,3)</code></p>

</body>
</html>
